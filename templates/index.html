<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenVINO Translation - AIÁøªË®≥„Çµ„Éº„Éì„Çπ</title>
    <link rel="stylesheet" href="/static/style.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="logo">
                <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="20" cy="20" r="18" fill="url(#gradient1)"/>
                    <path d="M15 15 L25 20 L15 25 Z" fill="white"/>
                    <defs>
                        <linearGradient id="gradient1" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                            <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                        </linearGradient>
                    </defs>
                </svg>
                <h1>OpenVINO Translation</h1>
            </div>
            <p class="subtitle">AI„ÇíÊ¥ªÁî®„Åó„ÅüÈ´òÈÄüÁøªË®≥„Çµ„Éº„Éì„Çπ</p>
        </header>

        <main class="main-content">
            <div class="translation-card">
                <div class="language-selector">
                    <div class="lang-option">
                        <label for="source-lang">ÂÖ•ÂäõË®ÄË™û</label>
                        <select id="source-lang" class="lang-select">
                            <option value="auto">Ëá™ÂãïÊ§úÂá∫</option>
                            {% for lang in languages %}
                            <option value="{{ lang.code }}">{{ lang.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <button class="swap-btn" id="swap-langs" title="Ë®ÄË™û„ÇíÂÖ•„ÇåÊõø„Åà">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M7 16V4M7 4L3 8M7 4L11 8" />
                            <path d="M17 8V20M17 20L21 16M17 20L13 16" />
                        </svg>
                    </button>
                    
                    <div class="lang-option">
                        <label for="target-lang">ÁøªË®≥ÂÖàË®ÄË™û</label>
                        <select id="target-lang" class="lang-select">
                            {% for lang in languages %}
                            <option value="{{ lang.code }}" {% if lang.code == 'ja' %}selected{% endif %}>{{ lang.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>

                <div class="text-areas">
                    <div class="input-area">
                        <textarea 
                            id="source-text" 
                            placeholder="ÁøªË®≥„Åó„Åü„ÅÑ„ÉÜ„Ç≠„Çπ„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ..."
                            rows="8"
                        ></textarea>
                        <div class="char-count">
                            <span id="char-count">0</span> / 5000
                        </div>
                    </div>

                    <div class="output-area">
                        <div id="translation-result" class="result-text">
                            ÁøªË®≥ÁµêÊûú„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô
                        </div>
                        <button class="copy-btn" id="copy-btn" title="„Ç≥„Éî„Éº">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                            </svg>
                            <span class="copy-text">„Ç≥„Éî„Éº</span>
                        </button>
                    </div>
                </div>

                <div class="actions">
                    <button class="btn btn-primary" id="translate-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M5 12h14M12 5l7 7-7 7"/>
                        </svg>
                        ÁøªË®≥„Åô„Çã
                    </button>
                    <button class="btn btn-secondary" id="clear-btn">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                        </svg>
                        „ÇØ„É™„Ç¢
                    </button>
                </div>

                <div id="loading" class="loading hidden">
                    <div class="spinner"></div>
                    <span>ÁøªË®≥‰∏≠...</span>
                </div>

                <div id="error-message" class="error-message hidden"></div>
            </div>

            <div class="api-docs">
                <h2>üìö API „Éâ„Ç≠„É•„É°„É≥„Éà</h2>
                <div class="api-section">
                    <h3>ÁøªË®≥ API</h3>
                    <code class="code-block">POST /api/translate</code>
                    <pre class="code-example">{
  "text": "Hello, world!",
  "target_lang": "ja",
  "source_lang": "en"  // „Ç™„Éó„Ç∑„Éß„É≥
}</pre>
                    <p>Ë©≥Á¥∞„Å™API„Éâ„Ç≠„É•„É°„É≥„Éà: <a href="/docs" target="_blank">/docs</a></p>
                </div>
            </div>
        </main>

        <footer class="footer">
            <p>Powered by OpenVINO‚Ñ¢ | FastAPI | Helsinki-NLP Models</p>
        </footer>
    </div>

    <script>
        // DOMË¶ÅÁ¥†„ÅÆÂèñÂæó
        const sourceText = document.getElementById('source-text');
        const translationResult = document.getElementById('translation-result');
        const translateBtn = document.getElementById('translate-btn');
        const clearBtn = document.getElementById('clear-btn');
        const copyBtn = document.getElementById('copy-btn');
        const swapBtn = document.getElementById('swap-langs');
        const sourceLang = document.getElementById('source-lang');
        const targetLang = document.getElementById('target-lang');
        const charCount = document.getElementById('char-count');
        const loading = document.getElementById('loading');
        const errorMessage = document.getElementById('error-message');

        // ÊñáÂ≠óÊï∞„Ç´„Ç¶„É≥„Éà
        sourceText.addEventListener('input', () => {
            const count = sourceText.value.length;
            charCount.textContent = count;
            
            if (count > 5000) {
                sourceText.value = sourceText.value.substring(0, 5000);
                charCount.textContent = '5000';
            }
        });

        // ÁøªË®≥ÂÆüË°å
        translateBtn.addEventListener('click', async () => {
            const text = sourceText.value.trim();
            
            if (!text) {
                showError('ÁøªË®≥„Åô„Çã„ÉÜ„Ç≠„Çπ„Éà„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }

            const sourceLangValue = sourceLang.value === 'auto' ? null : sourceLang.value;
            const targetLangValue = targetLang.value;

            if (sourceLangValue === targetLangValue) {
                showError('ÂÖ•ÂäõË®ÄË™û„Å®ÁøªË®≥ÂÖàË®ÄË™û„ÅåÂêå„Åò„Åß„Åô');
                return;
            }

            try {
                loading.classList.remove('hidden');
                errorMessage.classList.add('hidden');
                translateBtn.disabled = true;

                const response = await fetch('/api/translate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        text: text,
                        target_lang: targetLangValue,
                        source_lang: sourceLangValue
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || 'ÁøªË®≥„Å´Â§±Êïó„Åó„Åæ„Åó„Åü');
                }

                const data = await response.json();
                translationResult.textContent = data.translated_text;
                translationResult.classList.add('has-content');
                
                if (data.via_english) {
                    translationResult.textContent += '\n\n(Ëã±Ë™ûÁµåÁî±„ÅßÁøªË®≥„Åï„Çå„Åæ„Åó„Åü)';
                }

            } catch (error) {
                showError(error.message);
            } finally {
                loading.classList.add('hidden');
                translateBtn.disabled = false;
            }
        });

        // „ÇØ„É™„Ç¢„Éú„Çø„É≥
        clearBtn.addEventListener('click', () => {
            sourceText.value = '';
            translationResult.textContent = 'ÁøªË®≥ÁµêÊûú„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô';
            translationResult.classList.remove('has-content');
            charCount.textContent = '0';
            errorMessage.classList.add('hidden');
        });

        // „Ç≥„Éî„Éº„Éú„Çø„É≥
        copyBtn.addEventListener('click', () => {
            const text = translationResult.textContent;
            if (text && text !== 'ÁøªË®≥ÁµêÊûú„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô') {
                navigator.clipboard.writeText(text).then(() => {
                    const copyText = copyBtn.querySelector('.copy-text');
                    copyText.textContent = '„Ç≥„Éî„Éº„Åó„Åæ„Åó„Åü!';
                    setTimeout(() => {
                        copyText.textContent = '„Ç≥„Éî„Éº';
                    }, 2000);
                });
            }
        });

        // Ë®ÄË™ûÂÖ•„ÇåÊõø„Åà
        swapBtn.addEventListener('click', () => {
            if (sourceLang.value === 'auto') return;
            
            const temp = sourceLang.value;
            sourceLang.value = targetLang.value;
            targetLang.value = temp;
        });

        // „Ç®„É©„ÉºË°®Á§∫
        function showError(message) {
            errorMessage.textContent = message;
            errorMessage.classList.remove('hidden');
            setTimeout(() => {
                errorMessage.classList.add('hidden');
            }, 5000);
        }

        // Enter„Ç≠„Éº„ÅßÁøªË®≥
        sourceText.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'Enter') {
                translateBtn.click();
            }
        });
    </script>
</body>
</html>
